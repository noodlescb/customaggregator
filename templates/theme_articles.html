{% extends "base.html" %}

{% block title %}{{ theme.name }} - Articles - News-dles{% endblock %}

{% block content %}
<div class="page-header">
    <h2>{{ theme.name }}</h2>
    <a href="/trending" class="btn btn-secondary btn-small">← Back to Trending</a>
</div>

<div class="theme-profile">
    <div class="theme-info">
        {% if theme.explanation %}
        <div class="theme-explanation">
            <h3>What this theme represents</h3>
            <p>{{ theme.explanation }}</p>
        </div>
        {% endif %}
        
        {% if theme.insights %}
        <div class="theme-insights">
            <h3>Key messages and arguments</h3>
            <p>{{ theme.insights }}</p>
        </div>
        {% endif %}
    </div>
</div>

{% if articles %}
<div class="section-header">
    <h3>Articles expressing this theme ({{ articles|length }}{% if has_more %}+{% endif %})</h3>
</div>

<div class="articles-list">
    {% for article in articles %}
    <div class="article-item">
        <div class="article-header">
            <h4><a href="{{ article.url }}" target="_blank">{{ article.title or "Untitled Article" }}</a></h4>
            <div class="article-meta">
                {% if article.publication_date %}
                    <span class="article-date">{{ article.publication_date.strftime('%B %d, %Y') }}</span>
                {% endif %}
                {% if article.author %}
                    <span class="article-author">by {{ article.author }}</span>
                {% endif %}
                <span class="relevance-score">Relevance: {{ "%.1f" | format(article.relevance_score) }}</span>
            </div>
        </div>
        
        {% if article.description %}
        <div class="article-description">
            <p>{{ article.description[:200] }}{% if article.description|length > 200 %}...{% endif %}</p>
        </div>
        {% elif article.summary %}
        <div class="article-description">
            <p>{{ article.summary[:200] }}{% if article.summary|length > 200 %}...{% endif %}</p>
        </div>
        {% endif %}
        
        {% if article.topics or article.companies %}
        <div class="article-tags">
            {% if article.topics %}
                <div class="tag-group">
                    <strong>Topics:</strong>
                    {% for topic in article.topics[:3] %}
                        <a href="/?topic_id={{ topic.topic_id }}" class="tag topic-tag">{{ topic.name }}</a>
                    {% endfor %}
                    {% if article.topics|length > 3 %}
                        <span class="tag-more">+{{ article.topics|length - 3 }} more</span>
                    {% endif %}
                </div>
            {% endif %}
            
            {% if article.companies %}
                <div class="tag-group">
                    <strong>Companies:</strong>
                    {% for company in article.companies[:3] %}
                        <a href="/companies/{{ company.company_id }}" class="tag company-tag">{{ company.name }}</a>
                    {% endfor %}
                    {% if article.companies|length > 3 %}
                        <span class="tag-more">+{{ article.companies|length - 3 }} more</span>
                    {% endif %}
                </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
{% if prev_page or next_page %}
<div class="pagination">
    {% if prev_page %}
        <a href="/theme/{{ theme.theme_id }}/articles?page={{ prev_page }}" class="btn btn-secondary">← Previous</a>
    {% endif %}
    
    <span class="page-info">Page {{ page }}</span>
    
    {% if next_page %}
        <a href="/theme/{{ theme.theme_id }}/articles?page={{ next_page }}" class="btn btn-secondary">Next →</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="empty-state">
    <p>No articles found for this theme.</p>
</div>
{% endif %}

{% endblock %}

{% block scripts %}
<style>
.theme-profile {
    background-color: #2d2d2d;
    border: 1px solid #404040;
    border-radius: 5px;
    padding: 20px;
    margin-bottom: 25px;
}

.theme-explanation, .theme-insights {
    margin-bottom: 20px;
}

.theme-explanation h3, .theme-insights h3 {
    color: #ff6600;
    margin-bottom: 10px;
    font-size: 16px;
    font-weight: normal;
}

.articles-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.article-item {
    background-color: #2d2d2d;
    border: 1px solid #404040;
    border-radius: 5px;
    padding: 15px;
}

.article-header {
    margin-bottom: 10px;
}

.article-header h4 {
    margin: 0 0 8px 0;
    font-size: 16px;
    font-weight: normal;
}

.article-header h4 a {
    color: #ff6600;
    text-decoration: none;
}

.article-header h4 a:hover {
    text-decoration: underline;
}

.article-meta {
    display: flex;
    gap: 15px;
    font-size: 12px;
    color: #999;
}

.relevance-score {
    color: #007acc !important;
}

.article-description {
    margin-bottom: 15px;
    color: #ccc;
}

.article-tags {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.tag-group {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
}

.tag-group strong {
    color: #e6e6e6;
    white-space: nowrap;
}

.tag {
    display: inline-block;
    padding: 2px 6px;
    border-radius: 3px;
    text-decoration: none;
    font-size: 11px;
    white-space: nowrap;
}

.topic-tag {
    background-color: #4a4a2d;
    color: #e6e600;
}

.company-tag {
    background-color: #2d4a4a;
    color: #00cccc;
}

.tag:hover {
    opacity: 0.8;
}

.tag-more {
    color: #999;
    font-size: 11px;
}

.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 30px;
    padding: 20px;
}

.page-info {
    color: #ccc;
    font-size: 14px;
}

@media (max-width: 768px) {
    .article-meta {
        flex-direction: column;
        gap: 5px;
    }
    
    .tag-group {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .pagination {
        flex-direction: column;
        gap: 10px;
    }
}
</style>
{% endblock %}